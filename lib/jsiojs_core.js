"use strict";

var fs = require("fs")
var colors = require('colors')

var exports = module.exports = {};
  
exports.createFile =  function(fileName){
    checkJsFile(fileName)
    checkFileNotExist(fileName)
    fs.writeFile(fileName, '// Generated by JsIo.js\n');
    success('File '+fileName+' created with success !')
  }
  
exports.deleteFile =  function(fileName){
    checkJsFile(fileName)
    checkFileExist(fileName)
    fs.unlinkSync(fileName);
    success('File '+fileName+' deleted with success !' .green)
  }
  
exports.renameFile =  function(oldName, newName){
    checkJsFile(oldName)
    checkJsFile(newName)
    checkFileExist(oldName)
    checkFileNotExist(newName)
    fs.renameSync(oldName, newName)
    success('File '+oldName+' moved to '+newName+' with success !' .green)
  }    

exports.copyFile =  function(source, destination){
    checkJsFile(source)
    checkJsFile(destination)
    checkFileExist(source)
    checkFileNotExist(destination)
    fs.createReadStream(source).pipe(fs.createWriteStream(destination));
    success('File '+source+' copied to '+destination+' with success !' .green)
  }  

exports.showFile =  function(fileName){
    checkJsFile(fileName)
    checkFileExist(fileName)
    fs.createReadStream(fileName).pipe(process.stdout);
  }
  
function checkJsFile(fileName){
  if(fileName === undefined)
    throw "file name is missing";
  if(fileName.length < 4 || fileName.substring(fileName.length-3) !== ".js")
    throw fileName+" is not a valid javascript file name";
}  

function checkFileNotExist(fileName){
  if(fs.existsSync(fileName))
    throw fileName+" already exists"
}

function checkFileExist(fileName){
  if(!fs.existsSync(fileName))
    throw fileName+" does not exist"
}

function success(message){
  console.info(message .green)
}
